<!-- TEST 13:10 -->
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Original Tetris</title>
<style>
body {
  background: #111;
  color: white;
  font-family: sans-serif;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  margin:0;
  padding:20px;
}
.tetris-container {
  display: flex;
  flex-direction: row;
  gap: 20px;
}
#grid {
  display: grid;
  grid-template-columns: repeat(10, 30px);
  grid-template-rows: repeat(20, 30px);
  gap: 1px;
  background: #222;
  border: 2px solid #555;
}
.cell {
  width: 30px;
  height: 30px;
  background: #111;
  border-radius: 3px;
}
.filled {
  border-radius: 3px;
}
.controls {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
#next {
  display: grid;
  grid-template-columns: repeat(4,30px);
  grid-template-rows: repeat(4,30px);
  gap:1px;
  background:#222;
  border:2px solid #555;
}
button {
  padding: 8px 12px;
  cursor:pointer;
  font-size:16px;
}
</style>
</head>
<body>
<div class="tetris-container">
  <div>
    <div id="grid"></div>
    <div class="controls">
      <button id="startBtn">Start</button>
      <div id="score">Score: 0</div>
      <div id="level">Level: 1</div>
    </div>
  </div>
  <div>
    <div>Nächstes:</div>
    <div id="next"></div>
  </div>
</div>

<script>
const width = 10;
const height = 20;
const grid = document.getElementById('grid');
let cells = [];
let timerId;
let score = 0;
let level = 1;

// Tetrominos Farben
const colors = ['cyan','blue','orange','yellow','green','purple','red'];

// Tetrominos Definition
const lTetromino = [
  [1,width+1,width*2+1,2],
  [width,width+1,width+2,width*2+2],
  [1,width+1,width*2+1,width*2],
  [width,width*2,width*2+1,width*2+2]
];
const zTetromino = [
  [0,1,width+1,width+2],
  [1,width+1,width,width*2],
  [0,1,width+1,width+2],
  [1,width+1,width,width*2]
];
const tTetromino = [
  [1,width,width+1,width+2],
  [1,width+1,width+2,width*2+1],
  [width,width+1,width+2,2*width+1],
  [1,width,width+1,width*2+1]
];
const oTetromino = [
  [0,1,width,width+1],
  [0,1,width,width+1],
  [0,1,width,width+1],
  [0,1,width,width+1]
];
const iTetromino = [
  [1,width+1,width*2+1,width*3+1],
  [width,width+1,width+2,width+3],
  [1,width+1,width*2+1,width*3+1],
  [width,width+1,width+2,width+3]
];
const jTetromino = [
  [0,width,width*2,width*2+1],
  [width,width+1,width+2,2],
  [0,1,width+1,width*2+1],
  [width,width+1,width+2,width*2]
];
const sTetromino = [
  [1,2,width,width+1],
  [0,width,width+1,width*2+1],
  [1,2,width,width+1],
  [0,width,width+1,width*2+1]
];
const theTetrominoes = [lTetromino,zTetromino,tTetromino,oTetromino,iTetromino,jTetromino,sTetromino];

let currentPos = 4;
let currentRotation = 0;
let currentShape;
let currentColor;
let nextShape, nextColor;

// Grid erstellen
for(let i=0;i<width*height;i++){
  const div = document.createElement('div');
  div.className='cell';
  grid.appendChild(div);
  cells.push(div);
}

// Nächstes Tetromino Grid
const nextGrid = document.getElementById('next');
let nextCells = [];
for(let i=0;i<16;i++){
  const div = document.createElement('div');
  div.className='cell';
  nextGrid.appendChild(div);
  nextCells.push(div);
}

// Draw Tetromino
function draw(){
  currentShape[currentRotation].forEach(index => {
    cells[currentPos + index].style.background=currentColor;
    cells[currentPos + index].classList.add('filled');
  });
}
function undraw(){
  currentShape[currentRotation].forEach(index => {
    cells[currentPos + index].style.background='#111';
    cells[currentPos + index].classList.remove('filled');
  });
}

// Nächstes Tetromino anzeigen
function drawNext(){
  nextCells.forEach(cell=>cell.style.background='#111');
  nextShape[nextRotation].forEach(index=>{
    nextCells[index].style.background=nextColor;
  });
}
let nextRotation =0;

// Zufälliges Tetromino
function randomTetromino(){
  const rand = Math.floor(Math.random()*theTetrominoes.length);
  currentShape = theTetrominoes[rand];
  currentColor = colors[rand];
  currentRotation =0;

  const nextRand = Math.floor(Math.random()*theTetrominoes.length);
  nextShape = theTetrominoes[nextRand];
  nextColor = colors[nextRand];
  nextRotation =0;
  drawNext();
}

function moveDown(){
  undraw();
  currentPos += width;
  draw();
  freeze();
}

function freeze(){
  if(currentShape[currentRotation].some(index => cells[currentPos + index + width].classList.contains('filled') || (currentPos + index + width)>=width*height)){
    currentShape[currentRotation].forEach(index => cells[currentPos + index].classList.add('filled'));
    checkLines();
    // Nächstes Tetromino übernehmen
    currentShape = nextShape;
    currentColor = nextColor;
    currentPos = 4;
    currentRotation =0;
    // neues zufälliges Tetromino für Vorschau
    const rand = Math.floor(Math.random()*theTetrominoes.length);
    nextShape = theTetrominoes[rand];
    nextColor = colors[rand];
    drawNext();
    draw();
    if(currentShape[currentRotation].some(index => cells[currentPos + index].classList.contains('filled'))){
      alert("Game Over! Score: "+score);
      clearInterval(timerId);
    }
  }
}

function checkLines(){
  for(let r=0;r<height;r++){
    let row=[];
    for(let c=0;c<width;c++){
      row.push(r*width+c);
    }
    if(row.every(index => cells[index].classList.contains('filled'))){
      score+=10;
      scoreEl.textContent="Score: "+score;
      row.forEach(index=>{
        cells[index].classList.remove('filled');
        cells[index].style.background='#111';
      });
      const removed = cells.splice(r*width,width);
      cells = removed.concat(cells);
      grid.innerHTML='';
      cells.forEach(div=>grid.appendChild(div));
    }
  }
}

// Steuerung
document.addEventListener('keydown',control);
function control(e){
  if(e.keyCode===37) moveLeft();
  if(e.keyCode===38) rotate();
  if(e.keyCode===39) moveRight();
  if(e.keyCode===40) moveDown();
}

function moveLeft(){
  undraw();
  const isAtLeft=currentShape[currentRotation].some(index => (currentPos+index)%width===0);
  if(!isAtLeft) currentPos-=1;
  if(currentShape[currentRotation].some(index=>cells[currentPos+index].classList.contains('filled'))){
    currentPos+=1;
  }
  draw();
}
function moveRight(){
  undraw();
  const isAtRight=currentShape[currentRotation].some(index => (currentPos+index)%width===width-1);
  if(!isAtRight) currentPos+=1;
  if(currentShape[currentRotation].some(index=>cells[currentPos+index].classList.contains('filled'))){
    currentPos-=1;
  }
  draw();
}
function rotate(){
  undraw();
  currentRotation++;
  if(currentRotation===currentShape.length) currentRotation=0;
  if(currentShape[currentRotation].some(index=>cells[currentPos+index].classList.contains('filled'))){
    currentRotation--;
    if(currentRotation<0) currentRotation=currentShape.length-1;
  }
  draw();
}

// Start Button
startBtn.onclick = ()=>{
  randomTetromino();
  draw();
  timerId = setInterval(moveDown,500);
}
</script>
</body>
</html>
