<!-- TEST 13:10 -->
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Tetris Test</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    height: 100vh;
    background: #111;
    color: white;
    font-family: sans-serif;
    margin:0;
    padding:20px;
  }
  .tetris-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(10, 30px);
    grid-template-rows: repeat(20, 30px);
    gap: 1px;
    background: #222;
    border: 2px solid #555;
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #111;
    border-radius: 3px;
  }
  .filled {
    background: #f39c12;
  }
  .controls {
    margin-top: 20px;
  }
  button {
    padding: 8px 12px;
    margin: 0 5px;
    cursor: pointer;
    font-size: 16px;
  }
</style>
</head>
<body>

<div class="tetris-container">
  <div id="grid"></div>
  <div class="controls">
    <button id="startBtn">Start</button>
    <span id="score">Score: 0</span>
  </div>
</div>

<script>
const grid = document.getElementById('grid');
const scoreEl = document.getElementById('score');
const startBtn = document.getElementById('startBtn');
const width = 10;
const height = 20;
let cells = [];
let currentPos = 4;
let currentRotation = 0;
let currentShape;
let timerId;
let score = 0;

// ðŸŸ¦ Tetrominos (nur 2 Beispiele, du kannst erweitern)
const lTetromino = [
  [1, width+1, width*2+1, 2],
  [width, width+1, width+2, width*2+2],
  [1, width+1, width*2+1, width*2],
  [width, width*2, width*2+1, width*2+2]
];
const zTetromino = [
  [0,1,width+1,width+2],
  [1,width+1,width,width*2],
  [0,1,width+1,width+2],
  [1,width+1,width,width*2]
];
const theTetrominoes = [lTetromino, zTetromino];

// Grid erstellen
for(let i=0;i<width*height;i++){
  const div = document.createElement('div');
  div.className='cell';
  grid.appendChild(div);
  cells.push(div);
}

// Tetromino zeichnen
function draw(){
  currentShape[currentRotation].forEach(index => {
    cells[currentPos + index].classList.add('filled');
  });
}

// Tetromino entfernen
function undraw(){
  currentShape[currentRotation].forEach(index => {
    cells[currentPos + index].classList.remove('filled');
  });
}

// zufÃ¤lliger Tetromino
function randomTetromino(){
  const rand = Math.floor(Math.random() * theTetrominoes.length);
  currentShape = theTetrominoes[rand];
  currentRotation = 0;
  currentPos = 4;
}

function moveDown(){
  undraw();
  currentPos += width;
  draw();
  freeze();
}

// block einfrieren
function freeze(){
  if(currentShape[currentRotation].some(index => cells[currentPos + index + width].classList.contains('filled'))){
    currentShape[currentRotation].forEach(index => cells[currentPos + index].classList.add('filled'));
    checkLines();
    randomTetromino();
    draw();
    if(currentShape[currentRotation].some(index => cells[currentPos + index].classList.contains('filled'))){
      alert("Game Over! Score: "+score);
      clearInterval(timerId);
    }
  }
}

// Linien prÃ¼fen
function checkLines(){
  for(let r=0;r<height;r++){
    let row = [];
    for(let c=0;c<width;c++){
      row.push(r*width+c);
    }
    if(row.every(index => cells[index].classList.contains('filled'))){
      score += 10;
      scoreEl.textContent = "Score: "+score;
      row.forEach(index => cells[index].classList.remove('filled'));
      const removed = cells.splice(r*width, width);
      cells = removed.concat(cells);
      grid.innerHTML='';
      cells.forEach(div => grid.appendChild(div));
    }
  }
}

// Steuerung
function control(e){
  if(e.keyCode===37){moveLeft();}
  if(e.keyCode===38){rotate();}
  if(e.keyCode===39){moveRight();}
  if(e.keyCode===40){moveDown();}
}

function moveLeft(){
  undraw();
  const isAtLeft = currentShape[currentRotation].some(index => (currentPos + index) % width === 0);
  if(!isAtLeft) currentPos -= 1;
  if(currentShape[currentRotation].some(index => cells[currentPos + index].classList.contains('filled'))){
    currentPos +=1;
  }
  draw();
}
function moveRight(){
  undraw();
  const isAtRight = currentShape[currentRotation].some(index => (currentPos + index) % width === width-1);
  if(!isAtRight) currentPos += 1;
  if(currentShape[currentRotation].some(index => cells[currentPos + index].classList.contains('filled'))){
    currentPos -=1;
  }
  draw();
}
function rotate(){
  undraw();
  currentRotation++;
  if(currentRotation === currentShape.length) currentRotation = 0;
  draw();
}

// Start Game
startBtn.onclick = () => {
  randomTetromino();
  draw();
  timerId = setInterval(moveDown, 500);
  document.addEventListener('keydown', control);
}
</script>
</body>
</html>
